<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>File Sharing App - Friendly Web UI</title>
    <style>
        body { font-family: Arial, sans-serif; background:#fafafa; padding:24px; }
        h1 { color:#005bbb; }
        label { display:block; margin-top:10px; font-weight:bold; }
        input, select { width:360px; padding:8px; margin-top:4px; }
        button { padding:10px 24px; margin-top:16px; cursor:pointer; }
        #progressContainer { display:none; margin-top:16px; width:360px; background:#eee; }
        #progressBar { width:0; height:18px; background:#28a745; transition:width 0.2s; }
        #status { margin-top:10px; font-weight:bold; }
        small { color:#666; }
    </style>
</head>
<body>
<h1>üì¶ File Sharing App - Friendly Web UI</h1>
<p id="ipLine"></p>

<form id="transferForm">
    <label>Your Name (so I can cheer for you üòÑ):</label>
    <input id="name" type="text" placeholder="Example: SyedTheSender">

    <label>Who are you today?</label>
    <select id="role">
        <option value="">-- Please choose --</option>
        <option value="Sender">Sender</option>
        <option value="Receiver">Receiver</option>
    </select>

    <label>How to send the magic?</label>
    <select id="method">
        <option value="HTTP">HTTP (plain, fast, LAN friendly)</option>
        <option value="ZeroTier">ZeroTier (secure overlay - requires client)</option>
        <option value="S3">AWS S3 (needs IAM role)</option>
    </select>
    <small>
        For this build, the HTML form sends real data using HTTP.
        ZeroTier/S3 are handled by backend Java handlers.
    </small>

    <label>ZIP file(s) to send (Sender only):</label>
    <input id="files" type="file" multiple>
    <small>Example: your_photos.zip (Receiver does not need to pick files).</small>

    <label>Target Host / Receiver IP / S3 Bucket:</label>
    <input id="target" type="text" placeholder="HTTP/ZeroTier: 192.168.1.10 | S3: my-bucket">

    <label>Port (HTTP / ZeroTier):</label>
    <input id="port" type="number" value="8080">

    <button type="submit">üöÄ Start Transfer</button>
</form>

<div id="progressContainer">
    <div id="progressBar"></div>
</div>
<div id="status"></div>

<script>
    const ipLine = document.getElementById("ipLine");
    const form = document.getElementById("transferForm");
    const statusBox = document.getElementById("status");
    const progressContainer = document.getElementById("progressContainer");
    const progressBar = document.getElementById("progressBar");
    const nameInput = document.getElementById("name");
    const roleInput = document.getElementById("role");
    const methodInput = document.getElementById("method");
    const filesInput = document.getElementById("files");
    const portInput = document.getElementById("port");

    // Show basic IP / port info at top in friendly tone
    ipLine.textContent =
      `Your IP (share this with your partner): ${location.hostname} | Suggested port: ${portInput.value}`;

    form.addEventListener("submit", (e) => {
      e.preventDefault();
      statusBox.textContent = "";
      progressBar.style.width = "0%";
      progressContainer.style.display = "none";

      const name = nameInput.value.trim();
      const role = roleInput.value;
      const method = methodInput.value;
      const port = portInput.value.trim();
      const files = filesInput.files;

      // Friendly validations
      if (!name) {
        statusBox.textContent = "I need your name so I can cheer for you ü•π";
        return;
      }
      if (!role) {
        statusBox.textContent = "Tell me who you are today: Sender or Receiver? üòä";
        return;
      }
      if (role === "Sender" && files.length === 0 && method === "HTTP") {
        statusBox.textContent = "As Sender on HTTP, please choose at least one file üìÅ";
        return;
      }

      if (method !== "HTTP") {
        statusBox.textContent =
          "For this web form, only HTTP upload is triggered. ZeroTier & S3 are handled in Java backend.";
        return;
      }

      if (role !== "Sender") {
        statusBox.textContent =
          "For HTTP via Web UI, run this page on Receiver and use a separate Sender browser pointing here.";
        return;
      }

      // Build FormData for HTTP upload
      const formData = new FormData();
      formData.append("name", name);
      formData.append("role", role);
      formData.append("method", method);

      for (const f of files) {
        formData.append("files", f);
      }

      // Show progress UI
      progressContainer.style.display = "block";
      statusBox.textContent = "Uploading... I‚Äôve got this üí™";

      const xhr = new XMLHttpRequest();
      xhr.open("POST", "/api/send-http", true);

      // Track upload progress
      xhr.upload.onprogress = (event) => {
        if (event.lengthComputable) {
          const percent = (event.loaded / event.total) * 100;
          progressBar.style.width = percent.toFixed(1) + "%";
        }
      };

      xhr.onload = () => {
        if (xhr.status === 200) {
          statusBox.textContent = "Transfer success ‚úÖ " + xhr.responseText;
        } else {
          statusBox.textContent =
            "Transfer failed ‚ùå Status " + xhr.status + " - " + xhr.responseText;
        }
      };

      xhr.onerror = () => {
        statusBox.textContent = "Network error ‚ùå Please check connection and try again.";
      };

      xhr.send(formData);
    });
</script>
</body>
</html>
